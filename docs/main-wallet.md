# کیف پول کلی پروژه (Main Wallet)

## تعریف

**کیف پول کلی** نمایانگر مجموع دارایی‌های قابل استفاده برای سرمایه‌گذاری (صدور واحدهای صندوق) است. ارزش کل کیف پول از دو بخش تشکیل می‌شود:

- **موجودی کیف پول:** مبلغ نقدی که کاربر به کیف پول واریز کرده است.
- **مجموع اعتبارها:** اعتبار وام، اعتبار اوراق صندوق، اعتبار کریپتو و اعتبار TWIN.

```
ارزش کل = موجودی کیف پول + اعتبار وام + اعتبار اوراق صندوق + اعتبار کریپتو + اعتبار TWIN
```

همهٔ این منابع دارایی‌های قابل استفاده برای **سرمایه‌گذاری (صدور)** هستند؛ یعنی کاربر می‌تواند در مرحلهٔ فاکتور صدور از آن‌ها مطلع شود و (در فازهای بعدی) منبع پرداخت را انتخاب کند.

---

## منابع (Sources)

| منبع | توضیح |
|------|--------|
| **موجودی کیف پول** | مبلغی که کاربر با واریز به کیف پول اضافه کرده و با برداشت کم می‌کند. |
| **اعتبار وام** | اعتبار تخصیص‌یافته از تسهیلات وام. |
| **اعتبار اوراق صندوق** | اعتبار ناشی از اوراق صندوق. |
| **اعتبار کریپتو** | اعتبار مرتبط با دارایی کریپتو. |
| **اعتبار TWIN** | اعتبار TWIN. |

همهٔ مبالغ به **تومان** ذخیره و نمایش داده می‌شوند.

---

## جرنیش (تاریخچهٔ گردش)

برای شفافیت و حسابداری، هر تغییری در موجودی یا اعتبارها در **جرنیش کیف پول** ثبت می‌شود. انواع رویدادهایی که ثبت می‌شوند عبارت‌اند از:

- **واریز** به کیف پول
- **برداشت** از کیف پول
- **اعتبار وام / اوراق صندوق / کریپتو / TWIN** (هنگام تخصیص اعتبار)
- **استفاده برای صدور** (هنگام پرداخت از کیف پول برای خرید واحد صندوق)
- **ابطال** (دریافت مبلغ از ابطال واحد)

جرنیش در یک جا (ماژول `main-wallet-storage`) نگهداری می‌شود و در بخش «جرنیش کیف پول» در کارت جزئیات کیف پول در صفحهٔ اصلی نمایش داده می‌شود.

---

## محل پیاده‌سازی

- **ذخیره و API:** `src/app/(main)/app/wallet/lib/main-wallet-storage.ts`
- **صفحهٔ اصلی:** نمایش کیف پول و جرنیش در `src/app/(main)/app/page.tsx`
- **مرحلهٔ فاکتور صدور:** نمایش «کیف پول و موجودی‌ها» در `src/app/(main)/app/assets/trade/page.tsx` (فقط برای سفارش نوع صدور)
